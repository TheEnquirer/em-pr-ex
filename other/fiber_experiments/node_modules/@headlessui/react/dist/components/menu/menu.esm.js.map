{"version":3,"file":"menu.esm.js","sources":["../../../src/components/menu/menu.tsx"],"sourcesContent":["// WAI-ARIA: https://www.w3.org/TR/wai-aria-practices-1.2/#menubutton\nimport React, {\n  Fragment,\n  createContext,\n  createRef,\n  useCallback,\n  useContext,\n  useEffect,\n  useMemo,\n  useReducer,\n  useRef,\n\n  // Types\n  Dispatch,\n  ElementType,\n  KeyboardEvent as ReactKeyboardEvent,\n  MouseEvent as ReactMouseEvent,\n  MutableRefObject,\n  Ref,\n} from 'react'\n\nimport { Props } from '../../types'\nimport { match } from '../../utils/match'\nimport { forwardRefWithAs, render, Features, PropsForFeatures } from '../../utils/render'\nimport { disposables } from '../../utils/disposables'\nimport { useDisposables } from '../../hooks/use-disposables'\nimport { useIsoMorphicEffect } from '../../hooks/use-iso-morphic-effect'\nimport { useSyncRefs } from '../../hooks/use-sync-refs'\nimport { useId } from '../../hooks/use-id'\nimport { Keys } from '../keyboard'\nimport { Focus, calculateActiveIndex } from '../../utils/calculate-active-index'\nimport { isDisabledReactIssue7711 } from '../../utils/bugs'\nimport { isFocusableElement, FocusableMode } from '../../utils/focus-management'\nimport { useWindowEvent } from '../../hooks/use-window-event'\nimport { useTreeWalker } from '../../hooks/use-tree-walker'\nimport { useOpenClosed, State, OpenClosedProvider } from '../../internal/open-closed'\nimport { useResolveButtonType } from '../../hooks/use-resolve-button-type'\n\nenum MenuStates {\n  Open,\n  Closed,\n}\n\ntype MenuItemDataRef = MutableRefObject<{ textValue?: string; disabled: boolean }>\n\ninterface StateDefinition {\n  menuState: MenuStates\n  buttonRef: MutableRefObject<HTMLButtonElement | null>\n  itemsRef: MutableRefObject<HTMLDivElement | null>\n  items: { id: string; dataRef: MenuItemDataRef }[]\n  searchQuery: string\n  activeItemIndex: number | null\n}\n\nenum ActionTypes {\n  OpenMenu,\n  CloseMenu,\n\n  GoToItem,\n  Search,\n  ClearSearch,\n  RegisterItem,\n  UnregisterItem,\n}\n\ntype Actions =\n  | { type: ActionTypes.CloseMenu }\n  | { type: ActionTypes.OpenMenu }\n  | { type: ActionTypes.GoToItem; focus: Focus.Specific; id: string }\n  | { type: ActionTypes.GoToItem; focus: Exclude<Focus, Focus.Specific> }\n  | { type: ActionTypes.Search; value: string }\n  | { type: ActionTypes.ClearSearch }\n  | { type: ActionTypes.RegisterItem; id: string; dataRef: MenuItemDataRef }\n  | { type: ActionTypes.UnregisterItem; id: string }\n\nlet reducers: {\n  [P in ActionTypes]: (\n    state: StateDefinition,\n    action: Extract<Actions, { type: P }>\n  ) => StateDefinition\n} = {\n  [ActionTypes.CloseMenu](state) {\n    if (state.menuState === MenuStates.Closed) return state\n    return { ...state, activeItemIndex: null, menuState: MenuStates.Closed }\n  },\n  [ActionTypes.OpenMenu](state) {\n    if (state.menuState === MenuStates.Open) return state\n    return { ...state, menuState: MenuStates.Open }\n  },\n  [ActionTypes.GoToItem]: (state, action) => {\n    let activeItemIndex = calculateActiveIndex(action, {\n      resolveItems: () => state.items,\n      resolveActiveIndex: () => state.activeItemIndex,\n      resolveId: item => item.id,\n      resolveDisabled: item => item.dataRef.current.disabled,\n    })\n\n    if (state.searchQuery === '' && state.activeItemIndex === activeItemIndex) return state\n    return { ...state, searchQuery: '', activeItemIndex }\n  },\n  [ActionTypes.Search]: (state, action) => {\n    let searchQuery = state.searchQuery + action.value.toLowerCase()\n    let match = state.items.findIndex(\n      item =>\n        item.dataRef.current.textValue?.startsWith(searchQuery) && !item.dataRef.current.disabled\n    )\n\n    if (match === -1 || match === state.activeItemIndex) return { ...state, searchQuery }\n    return { ...state, searchQuery, activeItemIndex: match }\n  },\n  [ActionTypes.ClearSearch](state) {\n    if (state.searchQuery === '') return state\n    return { ...state, searchQuery: '' }\n  },\n  [ActionTypes.RegisterItem]: (state, action) => ({\n    ...state,\n    items: [...state.items, { id: action.id, dataRef: action.dataRef }],\n  }),\n  [ActionTypes.UnregisterItem]: (state, action) => {\n    let nextItems = state.items.slice()\n    let currentActiveItem = state.activeItemIndex !== null ? nextItems[state.activeItemIndex] : null\n\n    let idx = nextItems.findIndex(a => a.id === action.id)\n\n    if (idx !== -1) nextItems.splice(idx, 1)\n\n    return {\n      ...state,\n      items: nextItems,\n      activeItemIndex: (() => {\n        if (idx === state.activeItemIndex) return null\n        if (currentActiveItem === null) return null\n\n        // If we removed the item before the actual active index, then it would be out of sync. To\n        // fix this, we will find the correct (new) index position.\n        return nextItems.indexOf(currentActiveItem)\n      })(),\n    }\n  },\n}\n\nlet MenuContext = createContext<[StateDefinition, Dispatch<Actions>] | null>(null)\nMenuContext.displayName = 'MenuContext'\n\nfunction useMenuContext(component: string) {\n  let context = useContext(MenuContext)\n  if (context === null) {\n    let err = new Error(`<${component} /> is missing a parent <${Menu.name} /> component.`)\n    if (Error.captureStackTrace) Error.captureStackTrace(err, useMenuContext)\n    throw err\n  }\n  return context\n}\n\nfunction stateReducer(state: StateDefinition, action: Actions) {\n  return match(action.type, reducers, state, action)\n}\n\n// ---\n\nlet DEFAULT_MENU_TAG = Fragment\ninterface MenuRenderPropArg {\n  open: boolean\n}\n\nexport function Menu<TTag extends ElementType = typeof DEFAULT_MENU_TAG>(\n  props: Props<TTag, MenuRenderPropArg>\n) {\n  let reducerBag = useReducer(stateReducer, {\n    menuState: MenuStates.Closed,\n    buttonRef: createRef(),\n    itemsRef: createRef(),\n    items: [],\n    searchQuery: '',\n    activeItemIndex: null,\n  } as StateDefinition)\n  let [{ menuState, itemsRef, buttonRef }, dispatch] = reducerBag\n\n  // Handle outside click\n  useWindowEvent('mousedown', event => {\n    let target = event.target as HTMLElement\n\n    if (menuState !== MenuStates.Open) return\n\n    if (buttonRef.current?.contains(target)) return\n    if (itemsRef.current?.contains(target)) return\n\n    dispatch({ type: ActionTypes.CloseMenu })\n\n    if (!isFocusableElement(target, FocusableMode.Loose)) {\n      event.preventDefault()\n      buttonRef.current?.focus()\n    }\n  })\n\n  let slot = useMemo<MenuRenderPropArg>(() => ({ open: menuState === MenuStates.Open }), [\n    menuState,\n  ])\n\n  return (\n    <MenuContext.Provider value={reducerBag}>\n      <OpenClosedProvider\n        value={match(menuState, {\n          [MenuStates.Open]: State.Open,\n          [MenuStates.Closed]: State.Closed,\n        })}\n      >\n        {render({ props, slot, defaultTag: DEFAULT_MENU_TAG, name: 'Menu' })}\n      </OpenClosedProvider>\n    </MenuContext.Provider>\n  )\n}\n\n// ---\n\nlet DEFAULT_BUTTON_TAG = 'button' as const\ninterface ButtonRenderPropArg {\n  open: boolean\n}\ntype ButtonPropsWeControl =\n  | 'id'\n  | 'type'\n  | 'aria-haspopup'\n  | 'aria-controls'\n  | 'aria-expanded'\n  | 'onKeyDown'\n  | 'onClick'\n\nlet Button = forwardRefWithAs(function Button<TTag extends ElementType = typeof DEFAULT_BUTTON_TAG>(\n  props: Props<TTag, ButtonRenderPropArg, ButtonPropsWeControl>,\n  ref: Ref<HTMLButtonElement>\n) {\n  let [state, dispatch] = useMenuContext([Menu.name, Button.name].join('.'))\n  let buttonRef = useSyncRefs(state.buttonRef, ref)\n\n  let id = `headlessui-menu-button-${useId()}`\n  let d = useDisposables()\n\n  let handleKeyDown = useCallback(\n    (event: ReactKeyboardEvent<HTMLButtonElement>) => {\n      switch (event.key) {\n        // Ref: https://www.w3.org/TR/wai-aria-practices-1.2/#keyboard-interaction-13\n\n        case Keys.Space:\n        case Keys.Enter:\n        case Keys.ArrowDown:\n          event.preventDefault()\n          event.stopPropagation()\n          dispatch({ type: ActionTypes.OpenMenu })\n          d.nextFrame(() => dispatch({ type: ActionTypes.GoToItem, focus: Focus.First }))\n          break\n\n        case Keys.ArrowUp:\n          event.preventDefault()\n          event.stopPropagation()\n          dispatch({ type: ActionTypes.OpenMenu })\n          d.nextFrame(() => dispatch({ type: ActionTypes.GoToItem, focus: Focus.Last }))\n          break\n      }\n    },\n    [dispatch, d]\n  )\n\n  let handleKeyUp = useCallback((event: ReactKeyboardEvent<HTMLButtonElement>) => {\n    switch (event.key) {\n      case Keys.Space:\n        // Required for firefox, event.preventDefault() in handleKeyDown for\n        // the Space key doesn't cancel the handleKeyUp, which in turn\n        // triggers a *click*.\n        event.preventDefault()\n        break\n    }\n  }, [])\n\n  let handleClick = useCallback(\n    (event: ReactMouseEvent) => {\n      if (isDisabledReactIssue7711(event.currentTarget)) return event.preventDefault()\n      if (props.disabled) return\n      if (state.menuState === MenuStates.Open) {\n        dispatch({ type: ActionTypes.CloseMenu })\n        d.nextFrame(() => state.buttonRef.current?.focus({ preventScroll: true }))\n      } else {\n        event.preventDefault()\n        event.stopPropagation()\n        dispatch({ type: ActionTypes.OpenMenu })\n      }\n    },\n    [dispatch, d, state, props.disabled]\n  )\n\n  let slot = useMemo<ButtonRenderPropArg>(() => ({ open: state.menuState === MenuStates.Open }), [\n    state,\n  ])\n  let passthroughProps = props\n  let propsWeControl = {\n    ref: buttonRef,\n    id,\n    type: useResolveButtonType(props, state.buttonRef),\n    'aria-haspopup': true,\n    'aria-controls': state.itemsRef.current?.id,\n    'aria-expanded': props.disabled ? undefined : state.menuState === MenuStates.Open,\n    onKeyDown: handleKeyDown,\n    onKeyUp: handleKeyUp,\n    onClick: handleClick,\n  }\n\n  return render({\n    props: { ...passthroughProps, ...propsWeControl },\n    slot,\n    defaultTag: DEFAULT_BUTTON_TAG,\n    name: 'Menu.Button',\n  })\n})\n\n// ---\n\nlet DEFAULT_ITEMS_TAG = 'div' as const\ninterface ItemsRenderPropArg {\n  open: boolean\n}\ntype ItemsPropsWeControl =\n  | 'aria-activedescendant'\n  | 'aria-labelledby'\n  | 'id'\n  | 'onKeyDown'\n  | 'role'\n  | 'tabIndex'\n\nlet ItemsRenderFeatures = Features.RenderStrategy | Features.Static\n\nlet Items = forwardRefWithAs(function Items<TTag extends ElementType = typeof DEFAULT_ITEMS_TAG>(\n  props: Props<TTag, ItemsRenderPropArg, ItemsPropsWeControl> &\n    PropsForFeatures<typeof ItemsRenderFeatures>,\n  ref: Ref<HTMLDivElement>\n) {\n  let [state, dispatch] = useMenuContext([Menu.name, Items.name].join('.'))\n  let itemsRef = useSyncRefs(state.itemsRef, ref)\n\n  let id = `headlessui-menu-items-${useId()}`\n  let searchDisposables = useDisposables()\n\n  let usesOpenClosedState = useOpenClosed()\n  let visible = (() => {\n    if (usesOpenClosedState !== null) {\n      return usesOpenClosedState === State.Open\n    }\n\n    return state.menuState === MenuStates.Open\n  })()\n\n  useEffect(() => {\n    let container = state.itemsRef.current\n    if (!container) return\n    if (state.menuState !== MenuStates.Open) return\n    if (container === document.activeElement) return\n\n    container.focus({ preventScroll: true })\n  }, [state.menuState, state.itemsRef])\n\n  useTreeWalker({\n    container: state.itemsRef.current,\n    enabled: state.menuState === MenuStates.Open,\n    accept(node) {\n      if (node.getAttribute('role') === 'menuitem') return NodeFilter.FILTER_REJECT\n      if (node.hasAttribute('role')) return NodeFilter.FILTER_SKIP\n      return NodeFilter.FILTER_ACCEPT\n    },\n    walk(node) {\n      node.setAttribute('role', 'none')\n    },\n  })\n\n  let handleKeyDown = useCallback(\n    (event: ReactKeyboardEvent<HTMLDivElement>) => {\n      searchDisposables.dispose()\n\n      switch (event.key) {\n        // Ref: https://www.w3.org/TR/wai-aria-practices-1.2/#keyboard-interaction-12\n\n        // @ts-expect-error Fallthrough is expected here\n        case Keys.Space:\n          if (state.searchQuery !== '') {\n            event.preventDefault()\n            event.stopPropagation()\n            return dispatch({ type: ActionTypes.Search, value: event.key })\n          }\n        // When in type ahead mode, fallthrough\n        case Keys.Enter:\n          event.preventDefault()\n          event.stopPropagation()\n          dispatch({ type: ActionTypes.CloseMenu })\n          if (state.activeItemIndex !== null) {\n            let { id } = state.items[state.activeItemIndex]\n            document.getElementById(id)?.click()\n          }\n          disposables().nextFrame(() => state.buttonRef.current?.focus({ preventScroll: true }))\n          break\n\n        case Keys.ArrowDown:\n          event.preventDefault()\n          event.stopPropagation()\n          return dispatch({ type: ActionTypes.GoToItem, focus: Focus.Next })\n\n        case Keys.ArrowUp:\n          event.preventDefault()\n          event.stopPropagation()\n          return dispatch({ type: ActionTypes.GoToItem, focus: Focus.Previous })\n\n        case Keys.Home:\n        case Keys.PageUp:\n          event.preventDefault()\n          event.stopPropagation()\n          return dispatch({ type: ActionTypes.GoToItem, focus: Focus.First })\n\n        case Keys.End:\n        case Keys.PageDown:\n          event.preventDefault()\n          event.stopPropagation()\n          return dispatch({ type: ActionTypes.GoToItem, focus: Focus.Last })\n\n        case Keys.Escape:\n          event.preventDefault()\n          event.stopPropagation()\n          dispatch({ type: ActionTypes.CloseMenu })\n          disposables().nextFrame(() => state.buttonRef.current?.focus({ preventScroll: true }))\n          break\n\n        case Keys.Tab:\n          event.preventDefault()\n          event.stopPropagation()\n          break\n\n        default:\n          if (event.key.length === 1) {\n            dispatch({ type: ActionTypes.Search, value: event.key })\n            searchDisposables.setTimeout(() => dispatch({ type: ActionTypes.ClearSearch }), 350)\n          }\n          break\n      }\n    },\n    [dispatch, searchDisposables, state]\n  )\n\n  let handleKeyUp = useCallback((event: ReactKeyboardEvent<HTMLButtonElement>) => {\n    switch (event.key) {\n      case Keys.Space:\n        // Required for firefox, event.preventDefault() in handleKeyDown for\n        // the Space key doesn't cancel the handleKeyUp, which in turn\n        // triggers a *click*.\n        event.preventDefault()\n        break\n    }\n  }, [])\n\n  let slot = useMemo<ItemsRenderPropArg>(() => ({ open: state.menuState === MenuStates.Open }), [\n    state,\n  ])\n  let propsWeControl = {\n    'aria-activedescendant':\n      state.activeItemIndex === null ? undefined : state.items[state.activeItemIndex]?.id,\n    'aria-labelledby': state.buttonRef.current?.id,\n    id,\n    onKeyDown: handleKeyDown,\n    onKeyUp: handleKeyUp,\n    role: 'menu',\n    tabIndex: 0,\n    ref: itemsRef,\n  }\n  let passthroughProps = props\n\n  return render({\n    props: { ...passthroughProps, ...propsWeControl },\n    slot,\n    defaultTag: DEFAULT_ITEMS_TAG,\n    features: ItemsRenderFeatures,\n    visible,\n    name: 'Menu.Items',\n  })\n})\n\n// ---\n\nlet DEFAULT_ITEM_TAG = Fragment\ninterface ItemRenderPropArg {\n  active: boolean\n  disabled: boolean\n}\ntype MenuItemPropsWeControl =\n  | 'id'\n  | 'role'\n  | 'tabIndex'\n  | 'aria-disabled'\n  | 'onPointerLeave'\n  | 'onPointerMove'\n  | 'onMouseLeave'\n  | 'onMouseMove'\n  | 'onFocus'\n\nfunction Item<TTag extends ElementType = typeof DEFAULT_ITEM_TAG>(\n  props: Props<TTag, ItemRenderPropArg, MenuItemPropsWeControl> & {\n    disabled?: boolean\n    onClick?: (event: { preventDefault: Function }) => void\n  }\n) {\n  let { disabled = false, onClick, ...passthroughProps } = props\n  let [state, dispatch] = useMenuContext([Menu.name, Item.name].join('.'))\n  let id = `headlessui-menu-item-${useId()}`\n  let active = state.activeItemIndex !== null ? state.items[state.activeItemIndex].id === id : false\n\n  useIsoMorphicEffect(() => {\n    if (state.menuState !== MenuStates.Open) return\n    if (!active) return\n    let d = disposables()\n    d.nextFrame(() => document.getElementById(id)?.scrollIntoView?.({ block: 'nearest' }))\n    return d.dispose\n  }, [id, active, state.menuState])\n\n  let bag = useRef<MenuItemDataRef['current']>({ disabled })\n\n  useIsoMorphicEffect(() => {\n    bag.current.disabled = disabled\n  }, [bag, disabled])\n\n  useIsoMorphicEffect(() => {\n    bag.current.textValue = document.getElementById(id)?.textContent?.toLowerCase()\n  }, [bag, id])\n\n  useIsoMorphicEffect(() => {\n    dispatch({ type: ActionTypes.RegisterItem, id, dataRef: bag })\n    return () => dispatch({ type: ActionTypes.UnregisterItem, id })\n  }, [bag, id])\n\n  let handleClick = useCallback(\n    (event: MouseEvent) => {\n      if (disabled) return event.preventDefault()\n      dispatch({ type: ActionTypes.CloseMenu })\n      disposables().nextFrame(() => state.buttonRef.current?.focus({ preventScroll: true }))\n      if (onClick) return onClick(event)\n    },\n    [dispatch, state.buttonRef, disabled, onClick]\n  )\n\n  let handleFocus = useCallback(() => {\n    if (disabled) return dispatch({ type: ActionTypes.GoToItem, focus: Focus.Nothing })\n    dispatch({ type: ActionTypes.GoToItem, focus: Focus.Specific, id })\n  }, [disabled, id, dispatch])\n\n  let handleMove = useCallback(() => {\n    if (disabled) return\n    if (active) return\n    dispatch({ type: ActionTypes.GoToItem, focus: Focus.Specific, id })\n  }, [disabled, active, id, dispatch])\n\n  let handleLeave = useCallback(() => {\n    if (disabled) return\n    if (!active) return\n    dispatch({ type: ActionTypes.GoToItem, focus: Focus.Nothing })\n  }, [disabled, active, dispatch])\n\n  let slot = useMemo<ItemRenderPropArg>(() => ({ active, disabled }), [active, disabled])\n  let propsWeControl = {\n    id,\n    role: 'menuitem',\n    tabIndex: disabled === true ? undefined : -1,\n    'aria-disabled': disabled === true ? true : undefined,\n    disabled: undefined, // Never forward the `disabled` prop\n    onClick: handleClick,\n    onFocus: handleFocus,\n    onPointerMove: handleMove,\n    onMouseMove: handleMove,\n    onPointerLeave: handleLeave,\n    onMouseLeave: handleLeave,\n  }\n\n  return render({\n    props: { ...passthroughProps, ...propsWeControl },\n    slot,\n    defaultTag: DEFAULT_ITEM_TAG,\n    name: 'Menu.Item',\n  })\n}\n\n// ---\n\nMenu.Button = Button\nMenu.Items = Items\nMenu.Item = Item\n"],"names":["MenuStates","ActionTypes","reducers","CloseMenu","state","menuState","Closed","activeItemIndex","OpenMenu","Open","GoToItem","action","calculateActiveIndex","resolveItems","items","resolveActiveIndex","resolveId","item","id","resolveDisabled","dataRef","current","disabled","searchQuery","Search","value","toLowerCase","match","findIndex","textValue","startsWith","ClearSearch","RegisterItem","UnregisterItem","nextItems","slice","currentActiveItem","idx","a","splice","indexOf","MenuContext","createContext","displayName","useMenuContext","component","context","useContext","err","Error","Menu","name","captureStackTrace","stateReducer","type","DEFAULT_MENU_TAG","Fragment","props","reducerBag","useReducer","buttonRef","createRef","itemsRef","dispatch","useWindowEvent","event","target","contains","isFocusableElement","FocusableMode","Loose","preventDefault","focus","slot","useMemo","open","React","Provider","OpenClosedProvider","State","render","defaultTag","DEFAULT_BUTTON_TAG","Button","forwardRefWithAs","ref","join","useSyncRefs","useId","d","useDisposables","handleKeyDown","useCallback","key","Keys","Space","Enter","ArrowDown","stopPropagation","nextFrame","Focus","First","ArrowUp","Last","handleKeyUp","handleClick","isDisabledReactIssue7711","currentTarget","preventScroll","passthroughProps","propsWeControl","useResolveButtonType","undefined","onKeyDown","onKeyUp","onClick","DEFAULT_ITEMS_TAG","ItemsRenderFeatures","Features","RenderStrategy","Static","Items","searchDisposables","usesOpenClosedState","useOpenClosed","visible","useEffect","container","document","activeElement","useTreeWalker","enabled","accept","node","getAttribute","NodeFilter","FILTER_REJECT","hasAttribute","FILTER_SKIP","FILTER_ACCEPT","walk","setAttribute","dispose","getElementById","click","disposables","Next","Previous","Home","PageUp","End","PageDown","Escape","Tab","length","setTimeout","role","tabIndex","features","DEFAULT_ITEM_TAG","Item","active","useIsoMorphicEffect","scrollIntoView","block","bag","useRef","textContent","handleFocus","Nothing","Specific","handleMove","handleLeave","onFocus","onPointerMove","onMouseMove","onPointerLeave","onMouseLeave"],"mappings":"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"}