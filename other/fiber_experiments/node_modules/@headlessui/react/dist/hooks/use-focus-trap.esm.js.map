{"version":3,"file":"use-focus-trap.esm.js","sources":["../../src/hooks/use-focus-trap.ts"],"sourcesContent":["import {\n  useRef,\n  // Types\n  MutableRefObject,\n  useEffect,\n} from 'react'\n\nimport { Keys } from '../components/keyboard'\nimport { focusElement, focusIn, Focus, FocusResult } from '../utils/focus-management'\nimport { useWindowEvent } from './use-window-event'\nimport { useIsMounted } from './use-is-mounted'\n\nexport enum Features {\n  /** No features enabled for the `useFocusTrap` hook. */\n  None = 1 << 0,\n\n  /** Ensure that we move focus initially into the container. */\n  InitialFocus = 1 << 1,\n\n  /** Ensure that pressing `Tab` and `Shift+Tab` is trapped within the container. */\n  TabLock = 1 << 2,\n\n  /** Ensure that programmatically moving focus outside of the container is disallowed. */\n  FocusLock = 1 << 3,\n\n  /** Ensure that we restore the focus when unmounting the component that uses this `useFocusTrap` hook. */\n  RestoreFocus = 1 << 4,\n\n  /** Enable all features. */\n  All = InitialFocus | TabLock | FocusLock | RestoreFocus,\n}\n\nexport function useFocusTrap(\n  container: MutableRefObject<HTMLElement | null>,\n  features: Features = Features.All,\n  {\n    initialFocus,\n    containers,\n  }: {\n    initialFocus?: MutableRefObject<HTMLElement | null>\n    containers?: MutableRefObject<Set<MutableRefObject<HTMLElement | null>>>\n  } = {}\n) {\n  let restoreElement = useRef<HTMLElement | null>(\n    typeof window !== 'undefined' ? (document.activeElement as HTMLElement) : null\n  )\n  let previousActiveElement = useRef<HTMLElement | null>(null)\n  let mounted = useIsMounted()\n\n  let featuresRestoreFocus = Boolean(features & Features.RestoreFocus)\n  let featuresInitialFocus = Boolean(features & Features.InitialFocus)\n\n  // Capture the currently focused element, before we enable the focus trap.\n  useEffect(() => {\n    if (!featuresRestoreFocus) return\n\n    restoreElement.current = document.activeElement as HTMLElement\n  }, [featuresRestoreFocus])\n\n  // Restore the focus when we unmount the component.\n  useEffect(() => {\n    if (!featuresRestoreFocus) return\n\n    return () => {\n      focusElement(restoreElement.current)\n      restoreElement.current = null\n    }\n  }, [featuresRestoreFocus])\n\n  // Handle initial focus\n  useEffect(() => {\n    if (!featuresInitialFocus) return\n    if (!container.current) return\n\n    let activeElement = document.activeElement as HTMLElement\n\n    if (initialFocus?.current) {\n      if (initialFocus?.current === activeElement) {\n        previousActiveElement.current = activeElement\n        return // Initial focus ref is already the active element\n      }\n    } else if (container.current.contains(activeElement)) {\n      previousActiveElement.current = activeElement\n      return // Already focused within Dialog\n    }\n\n    // Try to focus the initialFocus ref\n    if (initialFocus?.current) {\n      focusElement(initialFocus.current)\n    } else {\n      if (focusIn(container.current, Focus.First) === FocusResult.Error) {\n        console.warn('There are no focusable elements inside the <FocusTrap />')\n      }\n    }\n\n    previousActiveElement.current = document.activeElement as HTMLElement\n  }, [container, initialFocus, featuresInitialFocus])\n\n  // Handle `Tab` & `Shift+Tab` keyboard events\n  useWindowEvent('keydown', event => {\n    if (!(features & Features.TabLock)) return\n\n    if (!container.current) return\n    if (event.key !== Keys.Tab) return\n\n    event.preventDefault()\n\n    if (\n      focusIn(\n        container.current,\n        (event.shiftKey ? Focus.Previous : Focus.Next) | Focus.WrapAround\n      ) === FocusResult.Success\n    ) {\n      previousActiveElement.current = document.activeElement as HTMLElement\n    }\n  })\n\n  // Prevent programmatically escaping the container\n  useWindowEvent(\n    'focus',\n    event => {\n      if (!(features & Features.FocusLock)) return\n\n      let allContainers = new Set(containers?.current)\n      allContainers.add(container)\n\n      if (!allContainers.size) return\n\n      let previous = previousActiveElement.current\n      if (!previous) return\n      if (!mounted.current) return\n\n      let toElement = event.target as HTMLElement | null\n\n      if (toElement && toElement instanceof HTMLElement) {\n        if (!contains(allContainers, toElement)) {\n          event.preventDefault()\n          event.stopPropagation()\n          focusElement(previous)\n        } else {\n          previousActiveElement.current = toElement\n          focusElement(toElement)\n        }\n      } else {\n        focusElement(previousActiveElement.current)\n      }\n    },\n    true\n  )\n}\n\nfunction contains(containers: Set<MutableRefObject<HTMLElement | null>>, element: HTMLElement) {\n  for (let container of containers) {\n    if (container.current?.contains(element)) return true\n  }\n\n  return false\n}\n"],"names":["Features","useFocusTrap","container","features","All","initialFocus","containers","restoreElement","useRef","window","document","activeElement","previousActiveElement","mounted","useIsMounted","featuresRestoreFocus","Boolean","RestoreFocus","featuresInitialFocus","InitialFocus","useEffect","current","focusElement","contains","focusIn","Focus","First","FocusResult","Error","console","warn","useWindowEvent","event","TabLock","key","Keys","Tab","preventDefault","shiftKey","Previous","Next","WrapAround","Success","FocusLock","allContainers","Set","add","size","previous","toElement","target","HTMLElement","stopPropagation","element"],"mappings":"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"}